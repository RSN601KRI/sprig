/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: Platformer Adventure
@author: Roshni Kumari
@tags: [platformer, adventure]
@addedOn: 2024-08-24
*/

const player = "p";
const platform = "x";
const goal = "g";
const obstacle = "o";

setLegend(
  [player, bitmap`
................
................
.......000......
.......0.0......
......0..0......
......0...0.0...
....0003.30.0...
....0.0...000...
....0.05550.....
......0...0.....
.....0....0.....
.....0...0......
......000.......
......0.0.......
.....00.00......
................`],
  [platform, bitmap`
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333`],
  [goal, bitmap`
................
................
.....222222.....
.....2....2.....
.....2....2.....
.....2....2.....
.....2....2.....
.....2....2.....
.....2....2.....
.....2....2.....
.....2....2.....
.....2....2.....
.....222222.....
................
................
................`],
  [obstacle, bitmap`
................
...5555555555...
...5........5...
...5........5...
...5........5...
...5........5...
...5........5...
...5........5...
...5........5...
...5........5...
...5........5...
...5........5...
...5........5...
...5555555555...
................
................`]
);

setSolids([player, platform]);

let level = 0;
const levels = [
  map`
p............
...x.........
..xxx........
...x.........
...x.........
..xxx....x...
...x.....x...
..xxx....x...
.........x...
g..xxxxx.x...
...x.....x...`,
  map`
p......xxxxxx
.....xxxxxx..
...xxxxxx....
xxxxx........
xxx..........
xx...........
xx..xxxxxx...
xx..xxxxxx...
xx..xxxxxx...
xx..xxxxxx...
xg.........x
xxxxxxxxxxxx`,
];

setMap(levels[level]);

setPushables({
  [player]: [],
});

onInput("w", () => {
  getFirst(player).y -= 1;
});

onInput("s", () => {
  getFirst(player).y += 1;
});

onInput("a", () => {
  getFirst(player).x -= 1;
});

onInput("d", () => {
  getFirst(player).x += 1;
});

afterInput(() => {
  // Check if player reaches the goal
  const playerPos = getFirst(player);
  const goalPos = getFirst(goal);
  
  if (playerPos.x === goalPos.x && playerPos.y === goalPos.y) {
    level++;
    if (level < levels.length) {
      setMap(levels[level]);
    } else {
      addText("You Win!", { x: 6, y: 4, color: color`3` });
    }
  }
});